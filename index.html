<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="16x16" href="img/duck/duck_16x_144p.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/duck/duck_32x_144p.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/duck/duck_96x_144p.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/duck/duck_192x_144p.png">
    <link rel="icon" type="image/png" sizes="500x500" href="img/duck/duck_500x_144p.png">
    <link rel="icon" type="image/png" sizes="1024x1024" href="img/duck/duck_1024x_144p.png">
    <link rel="apple-touch-icon" sizes="57x57" href="img/duck/duck_57x_144p.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/duck/duck_60x_144p.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/duck/duck_72x_144p.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/duck/duck_76x_144p.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/duck/duck_114x_144p.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/duck/duck_120x_144p.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/duck/duck_144x_144p.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/duck/duck_152x_144p.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/duck/duck_180x_144p.png">
    <link rel="stylesheet" href="https://lib.duckode.com/css/font-face.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/nav.css">
    <title>Duckode</title>
</head>

<body>
    <div class="duck">
        <div class="nav">
            <div class="navbtn">
                home
            </div>
            <div class="navbtn">
                contact
            </div>
        </div>
        <div class="content">
            <div class="home">
                <h1 class="title">Hello</h1>
            </div>
            <div class="contact">
                <h1>Contact</h1>
                <div class="field">
                    <div>
                        post status:
                        <button id="btn-status">private</button>
                        (click to change)
                    </div>
                    <div style="font-family: Poiret_One;" id="comment" contenteditable="true"></div>
                    <div class="comment-tools">
                        <div class="tools-blod">
                            B
                        </div>
                        <div class="tools-i">
                            <em style="font-family: 'Times New Roman', Times, serif;">I</em>
                        </div>
                        <div class="tools-size-num" contenteditable="true"></div>
                        <div class="tools-size plus">
                            &#43;
                        </div>
                        <div class="tools-size minus">
                            &#8722;
                        </div>
                    </div>
                    <div class="name-field">
                        <input placeholder="name.." type="text" id="name"
                            style="font-family: Poiret_One;font-weight: 900;" />
                    </div>
                </div>
                <div>
                    <button id="post" style="font-family: Poiret_One;font-weight: 900;">Post</button>
                    <button id="reply" style="font-family: Poiret_One;font-weight: 900;display: none;">Reply</button>
                    <button id="reply-x" style="font-family: Poiret_One;font-weight: 900;display: none;">Cancel</button>
                </div>
                <div id="comments" style="font-family: Poiret_One;"></div>
            </div>
        </div>
    </div>
    <script src="https://lib.duckode.com/js/scrollviewutils.min.js"></script>
    <script>
        document.querySelectorAll('.navbtn')[0].addEventListener("click", () => {
            scrollviewutils.cto('.home');
        });
        document.querySelectorAll('.navbtn')[1].addEventListener("click", () => {
            scrollviewutils.cto('.contact');
        });
    </script>
    <script src="https://lib.duckode.com/js/dynamicontent.min.js"></script>
    <script>
        dynamicontent.inititle(["Duckode", "Hello", "Quack, quack!"], document.querySelector('title'));
        dynamicontent.init(["Hello", "Duckode", "Quack, quack!"], document.querySelector('h1'), '#36f', 5000);
    </script>
    <script src="https://lib.duckode.com/js/motionbackground.min.js"></script>
    <script>
        motionbackground.initdotliner('#00000070', '#00000010');
    </script>
    <script src="js/index.js"></script>
    <script type="module">
        let initsie = false;
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        import { getDatabase, ref, child, get, set, update, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        window.addEventListener('scroll', sie);
        function sie() {
            if (scrollviewutils.sie("#comments") && !initsie) {
                // Your web app's Firebase configuration
                const firebaseConfig = {
                    apiKey: "AIzaSyA8hXpj7Jqo84IYASvibOT46r71WMSbN88",
                    authDomain: "source-c3817.firebaseapp.com",
                    projectId: "source-c3817",
                    storageBucket: "source-c3817.appspot.com",
                    messagingSenderId: "262948457201",
                    appId: "1:262948457201:web:bae1b685432d4bed84b750"
                };

                // Initialize Firebase
                const app = initializeApp(firebaseConfig);

                const database = getDatabase();
                let sizef = 0;

                let name = document.getElementById("name");
                let comment = document.getElementById("comment");
                let comments = document.getElementById('comments');

                document.getElementById("post").addEventListener('click', () => {
                    if (index.status()) {
                        ppost();
                    } else {
                        post();
                    }
                })

                function post() {
                    if (/^\s+$/.test(name.value)) {
                        return alert('Please enter a name using letters and numbers');
                    } else if (name.value.trim() === "") {
                        return alert('Please input your name');
                    } else if (comment.textContent.trim() === "") {
                        return alert('Please input comment');
                    } else if (name.value.includes('?id=')) {
                        return alert('error cannot include "?id="');
                    }
                    set(ref(database, 'comments/public/' + name.value + "?id=" + index.pID()), {
                        comment: comment.innerHTML,
                    })
                        .then(() => {
                            alert("Post Successed");
                            comments.innerHTML = "";

                            repost();
                            name.value = "";
                            comment.innerHTML = "";
                        })
                        .catch((error) => {
                            console.log(error);
                        })
                }
                repost();
                function repost() {
                    const dbref = ref(database);
                    get(child(dbref, 'comments/public/'))
                        .then((cmts) => {
                            if (cmts.exists()) {
                                cmts.forEach(e => {
                                    get(child(dbref, 'comments/public/' + e.key))
                                        .then((cmts) => {
                                            if (cmts.exists()) {
                                                cmts.forEach(c => {

                                                    if (!c.key.includes('?id=')) {

                                                        const container = document.createElement('div');
                                                        container.id = e.key;
                                                        comments.appendChild(container);

                                                        const h1 = document.createElement('h1');
                                                        h1.innerText = index.rcasc(e.key);
                                                        container.appendChild(h1);

                                                        const h3 = document.createElement('div');
                                                        h3.innerHTML = c.val();
                                                        container.appendChild(h3);

                                                        const btn = document.createElement('button');
                                                        btn.innerHTML = "Reply";
                                                        btn.style.fontFamily = "Poiret_One";
                                                        btn.style.fontWeight = "900";
                                                        btn.addEventListener("click", () => {

                                                            document.querySelector("#comment").focus();
                                                            document.querySelector("#post").style.display = "none";
                                                            document.querySelector("#reply").style.display = "";
                                                            document.querySelector("#reply").addEventListener("click", () => {
                                                                replypost(e);
                                                            });
                                                            document.querySelector("#reply-x").style.display = "";
                                                            document.querySelector("#reply-x").addEventListener("click", () => {
                                                                document.querySelector("#post").style.display = "";
                                                                document.querySelector("#reply").style.display = "none";
                                                                document.querySelector("#reply-x").style.display = "none";
                                                            });
                                                        });
                                                        container.appendChild(btn);
                                                    } else {
                                                        get(child(dbref, 'comments/public/' + e.key + "/" + c.key))
                                                            .then((cmts) => {
                                                                if (cmts.exists()) {
                                                                    cmts.forEach(r => {
                                                                        if (document.getElementById(e.key)) {
                                                                            const h3 = document.createElement('h3');
                                                                            h3.innerText = index.rcasc(c.key);
                                                                            document.getElementById(e.key).appendChild(h3);

                                                                            const div = document.createElement('div');
                                                                            div.innerHTML = r.val();
                                                                            document.getElementById(e.key).appendChild(div);
                                                                        }
                                                                    });
                                                                }
                                                            })
                                                    }

                                                    setTimeout(() => {
                                                        if (document.getElementById(e.key)) {
                                                            document.getElementById(e.key).removeAttribute('id');
                                                        }
                                                    }, 300);
                                                });
                                            }
                                        })
                                });
                            } else {
                                const h6 = document.createElement('h3');
                                h6.innerText = "none comments";
                                h6.style.opacity = "0.5";
                                comments.appendChild(h6);
                            }
                        })
                }
                function ppost() {
                    if (/^\s+$/.test(name.value)) {
                        return alert('Please enter a name using letters and numbers');
                    } else if (name.value.trim() === "") {
                        return alert('Please input your name');
                    } else if (comment.textContent.trim() === "") {
                        return alert('Please input comment');
                    } else if (name.value.includes('?id=')) {
                        return alert('error cannot include "?id="');
                    }
                    set(ref(database, 'comments/private/' + name.value + "?id=" + index.pID()), {
                        comment: comment.innerHTML,
                    })
                        .then(() => {
                            alert("Post Successed");
                            comments.innerHTML = "";

                            repost();
                            name.value = "";
                            comment.innerHTML = "";
                        })
                        .catch((error) => {
                            console.log(error);
                        })
                }
                function replypost(e) {
                    if (/^\s+$/.test(name.value)) {
                        return alert('Please enter a name using letters and numbers');
                    } else if (name.value.trim() === "") {
                        return alert('Please input your name');
                    } else if (comment.textContent.trim() === "") {
                        return alert('Please input comment');
                    } else if (name.value.includes('?id=')) {
                        return alert('error cannot include "?id="');
                    }
                    set(ref(database, 'comments/public/' + e.key + '/' + name.value + "?id=" + index.pID()), {
                        comment: comment.innerHTML,
                    })
                        .then(() => {
                            alert("Post Successed");
                            comments.innerHTML = "";

                            repost();
                            name.value = "";
                            comment.innerHTML = "";
                        })
                        .catch((error) => {
                            console.log(error);
                        })
                }
                initsie = true;
                window.removeEventListener('scroll', sie);
            }
        }
    </script>
</body>

</html>